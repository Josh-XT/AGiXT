name: Publish Docker image

on:
  push:

permissions:
  packages: write
  contents: read

jobs:

  call-docker-build:
    uses: ./.github/workflows/operation-docker-build-publish.yml
    with:
      image-name: ${{ github.repository }}
      dockerfile: Dockerfile
    secrets: inherit

  call-docker-build-local:
    uses: ./.github/workflows/operation-docker-build-publish.yml
    with:
      image-name: ${{ github.repository }}-local
      dockerfile: Dockerfile.local
      build-args: |
        DIGEST=${{needs.call-docker-build.outputs.digest}}
    secrets: inherit
    needs: call-docker-build
   
  call-docker-build-streamlit:
    uses: ./.github/workflows/operation-docker-build-publish.yml
    with:
      image-name: ${{ github.repository }}-streamlit
      dockerfile: Dockerfile.streamlit
    secrets: inherit
    
  call-docker-build-streamlit-local:
    uses: ./.github/workflows/operation-docker-build-publish.yml
    with:
      image-name: ${{ github.repository }}-streamlit-local
      dockerfile: Dockerfile.local
      build-args: |
        VARIANT=-streamlit
        DIGEST=${{needs.call-docker-build-streamlit.outputs.digest}}
    secrets: inherit
    needs: call-docker-build-streamlit
